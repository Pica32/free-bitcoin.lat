---
import BaseLayout from "./BaseLayout.astro";

interface HreflangItem {
  lang: string;
  href: string;
}

interface Props {
  title: string;
  description: string;
  canonical: string;
  hreflang?: HreflangItem[];
  jsonLd?: object | object[];
  ogImage?: string;
  lastUpdated: string;
  readingTime?: number;
  sourceBadge?: string;
  author?: string;
}

const {
  title,
  description,
  canonical,
  hreflang = [],
  jsonLd,
  ogImage,
  lastUpdated,
  readingTime,
  sourceBadge,
  author,
} = Astro.props;

// Format date for display
const formattedDate = new Date(lastUpdated).toLocaleDateString("es-419", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

// Article structured data
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  headline: title,
  description: description,
  dateModified: lastUpdated,
  datePublished: lastUpdated,
  author: {
    "@type": "Organization",
    name: author ?? "free-bitcoin.lat",
    url: "https://free-bitcoin.lat",
  },
  publisher: {
    "@type": "Organization",
    name: "free-bitcoin.lat",
    url: "https://free-bitcoin.lat",
    logo: {
      "@type": "ImageObject",
      url: "https://free-bitcoin.lat/logo.png",
    },
  },
};

const combinedJsonLd = jsonLd
  ? Array.isArray(jsonLd)
    ? [articleSchema, ...jsonLd]
    : [articleSchema, jsonLd]
  : [articleSchema];
---

<BaseLayout
  title={title}
  description={description}
  canonical={canonical}
  hreflang={hreflang}
  jsonLd={combinedJsonLd}
  ogImage={ogImage}
>
  <slot name="head" slot="head" />

  <div class="article-layout">
    <div class="container">
      <div class="article-grid">
        <!-- Article Main -->
        <article class="article-main" itemscope itemtype="https://schema.org/Article">
          <!-- Article Header -->
          <header class="article-header">
            {sourceBadge && (
              <span class="source-badge">{sourceBadge}</span>
            )}
            <h1 itemprop="headline">{title}</h1>
            <div class="article-meta">
              <span class="last-updated" itemprop="dateModified" content={lastUpdated}>
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  aria-hidden="true"
                >
                  <circle cx="12" cy="12" r="10" />
                  <polyline points="12 6 12 12 16 14" />
                </svg>
                Actualizado: {formattedDate}
              </span>
              {readingTime && (
                <span class="reading-time">
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                  </svg>
                  {readingTime} min de lectura
                </span>
              )}
            </div>
          </header>

          <!-- Article Content -->
          <div class="article-prose" itemprop="articleBody">
            <slot />
          </div>
        </article>

        <!-- Sidebar -->
        <aside class="article-sidebar">
          <slot name="sidebar" />
        </aside>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .article-layout {
    padding: var(--space-8) 0 var(--space-16);
  }

  .article-grid {
    display: grid;
    grid-template-columns: 1fr 280px;
    gap: var(--space-12);
    align-items: start;
  }

  .article-sidebar:empty {
    display: none;
  }

  /* Article header */
  .article-header {
    margin-bottom: var(--space-8);
    padding-bottom: var(--space-6);
    border-bottom: 1px solid var(--c-border);
  }

  .source-badge {
    display: inline-block;
    background: rgba(255, 107, 0, 0.12);
    border: 1px solid rgba(255, 107, 0, 0.3);
    color: var(--c-primary);
    font-size: 0.72rem;
    font-weight: 700;
    font-family: var(--font-display);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 0.2em 0.7em;
    border-radius: 100px;
    margin-bottom: var(--space-3);
  }

  .article-header h1 {
    margin-bottom: var(--space-4);
  }

  .article-meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-4);
    align-items: center;
  }

  .reading-time {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.8rem;
    color: var(--c-text-muted);
  }

  /* Article prose styling */
  .article-prose {
    line-height: 1.75;
  }

  .article-prose h2 {
    margin-top: var(--space-12);
    margin-bottom: var(--space-4);
    padding-bottom: var(--space-3);
    border-bottom: 1px solid var(--c-border);
  }

  .article-prose h3 {
    margin-top: var(--space-8);
    margin-bottom: var(--space-3);
  }

  .article-prose h4 {
    margin-top: var(--space-6);
    margin-bottom: var(--space-2);
  }

  .article-prose ul,
  .article-prose ol {
    padding-left: var(--space-6);
    margin-bottom: var(--space-4);
  }

  .article-prose li {
    margin-bottom: var(--space-2);
    color: var(--c-text);
  }

  .article-prose strong {
    color: var(--c-text);
    font-weight: 600;
  }

  .article-prose code {
    font-family: var(--font-mono);
    font-size: 0.88em;
    background: var(--c-surface-2);
    border: 1px solid var(--c-border);
    border-radius: var(--radius-sm);
    padding: 0.1em 0.4em;
    color: var(--c-primary);
  }

  .article-prose pre {
    background: var(--c-surface-2);
    border: 1px solid var(--c-border);
    border-radius: var(--radius-md);
    padding: var(--space-4) var(--space-6);
    overflow-x: auto;
    margin-bottom: var(--space-4);
  }

  .article-prose pre code {
    background: none;
    border: none;
    padding: 0;
    color: var(--c-text);
    font-size: 0.875rem;
  }

  .article-prose blockquote {
    border-left: 3px solid var(--c-primary);
    padding-left: var(--space-4);
    color: var(--c-text-muted);
    font-style: italic;
    margin: var(--space-6) 0;
  }

  /* Sidebar sticky */
  .article-sidebar {
    position: sticky;
    top: calc(64px + var(--space-6));
  }

  @media (max-width: 900px) {
    .article-grid {
      grid-template-columns: 1fr;
    }

    .article-sidebar {
      position: static;
      order: -1;
    }
  }
</style>
