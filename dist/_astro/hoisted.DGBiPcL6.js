import"./hoisted.COZWcr4e.js";function w(){document.querySelectorAll("[data-faq-trigger]").forEach(t=>{t.replaceWith(t.cloneNode(!0))}),document.querySelectorAll("[data-faq-trigger]").forEach(t=>{t.addEventListener("click",()=>{const e=t.closest(".faq-item");if(!e)return;const n=e.classList.contains("open"),a=t.getAttribute("aria-controls")??"",c=document.getElementById(a);n?(e.classList.remove("open"),t.setAttribute("aria-expanded","false"),c&&(c.style.display="none")):(e.classList.add("open"),t.setAttribute("aria-expanded","true"),c&&(c.style.display="block"))})})}w();document.addEventListener("astro:page-load",w);const L=97e3;function b(t,e=2){return t.toLocaleString("es-419",{minimumFractionDigits:e,maximumFractionDigits:e})}function v(t){return`$${b(t,2)} USD`}function j(t){return`${b(t,6)} BTC`}async function A(){try{const t=await fetch("/api/price.php",{signal:AbortSignal.timeout(4e3),headers:{Accept:"application/json"}});if(!t.ok)throw new Error("api error");const e=await t.json();if(e.usd&&e.usd>0)return e.usd;throw new Error("invalid")}catch{try{const t=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd",{signal:AbortSignal.timeout(5e3),headers:{Accept:"application/json"}});if(!t.ok)throw new Error("cg error");const e=await t.json();if(e.bitcoin?.usd)return e.bitcoin.usd}catch{}return L}}function M(t){const{amountPerPeriod:e,periods:n,startPrice:a}=t,c=[];let o=a,f=0,l=0,i=a+n+e;function u(){return i=i*1664525+1013904223&4294967295,(i>>>0)/4294967295}for(let m=0;m<n;m++){const p=(u()-.47)*.06;o=Math.max(1e3,o*(1+p));const y=e/o;f+=y,l+=e,c.push({period:m+1,price:o,btcBought:y,btcTotal:f,totalInvested:l})}return c}function U(t){const e=document.getElementById("dca-chart-line"),n=document.getElementById("dca-chart-area");if(!e||!n||t.length===0)return;const a=600,c=160,o={top:8,right:4,bottom:4,left:4},f=Math.max(...t.map(r=>r.btcTotal)),l=0,i=f-l||1;function u(r){return o.left+r/(t.length-1)*(a-o.left-o.right)}function m(r){return o.top+(1-(r-l)/i)*(c-o.top-o.bottom)}const p=t.map((r,E)=>`${u(E).toFixed(1)},${m(r.btcTotal).toFixed(1)}`);e.setAttribute("points",p.join(" "));const y=u(0).toFixed(1),s=u(t.length-1).toFixed(1),g=(c-o.bottom).toFixed(1);n.setAttribute("d",`M ${p[0]} L ${p.join(" L ")} L ${s},${g} L ${y},${g} Z`)}function k(){const t=document.getElementById("dca-form");if(!t||t._dcaInit)return;t._dcaInit=!0;const e=document.getElementById("dca-results"),n=document.getElementById("dca-error"),a=document.getElementById("dca-submit"),c=document.getElementById("dca-total-invested"),o=document.getElementById("dca-btc-total"),f=document.getElementById("dca-avg-price"),l=document.getElementById("dca-current-value"),i=document.getElementById("dca-pnl"),u=document.getElementById("dca-ref-price"),m=document.getElementById("dca-chart-x-start"),p=document.getElementById("dca-chart-x-end"),y={daily:30,weekly:4,monthly:1};let s=null;A().then(g=>{s=g}),t.addEventListener("submit",async g=>{g.preventDefault(),n.style.display="none",n.textContent="";const r=parseFloat(document.getElementById("dca-amount").value),E=document.getElementById("dca-frequency").value,h=parseInt(document.getElementById("dca-months").value,10),x=parseFloat(document.getElementById("dca-start-price").value);if(!r||r<=0){n.textContent="Introduce una cantidad válida mayor a 0.",n.style.display="block";return}if(!h||h<1||h>120){n.textContent="El período debe estar entre 1 y 120 meses.",n.style.display="block";return}if(!x||x<=0){n.textContent="El precio inicial debe ser mayor a 0.",n.style.display="block";return}a.disabled=!0,a.textContent="Calculando…",s===null&&(s=await A());const T=y[E]??1,$=h*T,C=M({amountPerPeriod:r,periods:$,startPrice:x}),d=C[C.length-1],F=d.totalInvested/d.btcTotal,B=d.btcTotal*s,I=B-d.totalInvested,S=I/d.totalInvested*100;c.textContent=v(d.totalInvested),o.textContent=j(d.btcTotal),f.textContent=v(F),l.textContent=v(B),l.style.color=B>=d.totalInvested?"var(--c-success)":"var(--c-error)";const P=I>=0?"+":"";i.textContent=`${P}${v(I)} (${P}${b(S,1)}%)`,i.style.color=I>=0?"var(--c-success)":"var(--c-error)";const D=s===L?`$${b(s,0)} USD (estimado)`:`$${b(s,0)} USD`;u.textContent=D;const q={daily:"días",weekly:"semanas",monthly:"meses"};m.textContent="Período 1",p.textContent=`Período ${$} (${h} ${q[E]??"meses"})`,U(C),e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"nearest"}),a.disabled=!1,a.textContent="Calcular"})}k();document.addEventListener("astro:page-load",k);
